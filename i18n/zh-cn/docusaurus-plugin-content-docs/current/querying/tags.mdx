---
sidebar_position: 4080
title: 查询标记
description: Using query tags to help identify specific queries in log messages emitted by Linq Entity Framework
author: smitpatel
ms.date: 11/14/2018
uid: core/querying/tags
---

import TagsQuery from '!!raw-loader!../../../../../static/samples/Querying/Tags/Program.cs';

# 查询标记

查询标记有助于将代码中的 LINQ 查询与日志中捕获的已生成 SQL 查询相关联。 使用新增的 `TagWith()` 方法对 LINQ 查询进行批注：


> [!TIP]
可在 GitHub 上查看此文章的[示例](https://github.com/dotnet/EntityFramework.Docs/tree/main/samples/core/Querying/Tags)。
> 

<CodeSnippets title="C#" language="csharp" fragment="BasicQueryTag" showLineNumbers>{TagsQuery}</CodeSnippets>

此 LINQ 查询转换为以下 SQL 语句：

```sql title="SQL"
-- This is my spatial query!

SELECT TOP(@__p_1) [p].[Id], [p].[Location]
FROM [People] AS [p]
ORDER BY [p].[Location].STDistance(@__myLocation_0) DESC
```

可以对同一个查询多次调用 `TagWith()`。 查询标记具有累积性。 例如，给定方法如下：

<CodeSnippets title="C#" language="csharp" fragment="QueryableMethods" showLineNumbers>{TagsQuery}</CodeSnippets>

以下查询：

<CodeSnippets title="C#" language="csharp" fragment="ChainedQueryTags" showLineNumbers>{TagsQuery}</CodeSnippets>

转换为：

```sql title="SQL"
-- GetNearestPeople

-- Limit

SELECT TOP(@__p_1) [p].[Id], [p].[Location]
FROM [People] AS [p]
ORDER BY [p].[Location].STDistance(@__myLocation_0) DESC
```

也可以使用多行字符串作为查询标记。 例如：



<CodeSnippets title="C#" language="csharp" fragment="MultilineQueryTag" showLineNumbers>{TagsQuery}</CodeSnippets>

生成以下 SQL：

```sql title="SQL"
-- GetNearestPeople

-- Limit

-- This is a multi-line
-- string

SELECT TOP(@__p_1) [p].[Id], [p].[Location]
FROM [People] AS [p]
ORDER BY [p].[Location].STDistance(@__myLocation_0) DESC
```

## 已知的限制

**查询标记不可参数化：**
EF Core 始终将 LINQ 查询中的查询标记视为，已生成 SQL 中包含的字符串文本。 禁止使用将查询标记用作参数的已编译查询。
